# RDForward

From RubyDung to Minecraft. An upgraded multiplayer MC experience, compatible with all publicly available MC versions. Using Fabric mod loader and adding multiplayer and mods to everything. Not affiliated with Mojang or Microsoft in any way.

## Quick Start

Requires **Java 21+** and an internet connection (first build only).

```bash
# First-time setup: downloads RubyDung from Mojang, decompiles, applies patches
./gradlew :rd-game:setupWorkspace

# Build everything
./gradlew build

# Launch the game
./gradlew :rd-game:runClient
```

### Why BuildTools?

RDForward uses a **Spigot BuildTools-style** build process. The original RubyDung code
(rd-132211) is Mojang's copyrighted property and cannot be redistributed. Instead, our
build tool downloads the original JAR from Mojang's CDN, decompiles it with Vineflower,
and applies our patches — all on your machine. Only the patches (our modifications) are
stored in this repository.

### Developer Workflow

```bash
# After modifying decompiled source in rd-game/src/main/java/:
./gradlew :rd-game:rebuildPatches   # Saves your changes as patch files
# Commit the updated patches in rd-game/patches/
```

## Project Structure

This is a Gradle multi-module project:

| Module | Description |
|--------|-------------|
| `rd-game` | **The game** — decompiled RubyDung (generated by BuildTools, not in version control) |
| `rd-protocol` | Networking — Netty-based packet codec, MC-compatible protocol, version translation |
| `rd-world` | World persistence — Alpha-format NBT serialization, block registry |
| `rd-client` | Multiplayer client — networking, UI overlays, remote player rendering |
| `rd-server` | Dedicated server — authoritative world state, tick loop, mod event dispatch |

## Key Design Decisions

- **MC-compatible protocol** — packet IDs and wire format match real Minecraft Classic/Alpha
- **Netty** for networking (same library modern MC uses) — scalable to 100+ players
- **ViaVersion-inspired version translation** — block/action mapping between protocol versions
- **Alpha-compatible world format** — worlds can be opened in Minecraft Alpha
- **LWJGL 3.4.1** — ported from LWJGL 2 for Java 21+ compatibility on all platforms (see below)
- **Fabric Loader + SpongePowered Mixin** for mod loading and code injection
- **BuildTools approach** — no copyrighted code in the repository

## Building

Requires Java 21+ and Gradle 8.14+.

```bash
./gradlew :rd-game:setupWorkspace   # First-time only
./gradlew build
```

## LWJGL 2 to LWJGL 3 Migration

The original RubyDung (rd-132211) was built against **LWJGL 2.9.3**. We ported it to
**LWJGL 3.4.1** because LWJGL 2's Linux native libraries (`liblwjgl64.so`) depend on
`SUNWprivate_1.1`, a private JDK symbol removed in Java 9+. This makes LWJGL 2 unusable
on Linux with modern Java.

### What Changed

LWJGL 3 is a complete API rewrite, not a drop-in upgrade. Key differences for developers:

| LWJGL 2 | LWJGL 3 | Notes |
|---------|---------|-------|
| `Display.create()` / `setTitle()` | `GLFW.glfwCreateWindow()` | GLFW replaces the Display class entirely |
| `Keyboard.isKeyDown(int)` | `GLFW.glfwGetKey(window, key)` | Key codes changed (e.g. `Keyboard.KEY_W` -> `GLFW.GLFW_KEY_W`) |
| `Keyboard.next()` / event loop | `glfwSetKeyCallback()` | Push-based callbacks instead of poll-based event queue |
| `Mouse.getDX()` / `getDY()` | `glfwSetCursorPosCallback()` | Must track deltas manually from absolute positions |
| `Mouse.setGrabbed(true)` | `glfwSetInputMode(GLFW_CURSOR, GLFW_CURSOR_DISABLED)` | |
| `GLU.gluPerspective()` | Manual matrix math | GLU was removed; perspective matrix built by hand |
| `GLU.gluPickMatrix()` | Manual translate + scale | |
| `GLU.gluBuild2DMipmaps()` | `glTexImage2D()` + `GL30.glGenerateMipmap()` | |
| `GL11.glVertexPointer(size, stride, buf)` | `GL11.glVertexPointer(size, GL_FLOAT, stride, buf)` | Explicit type parameter required |
| `GL11.glGetFloat(int, buf)` | `GL11.glGetFloatv(int, buf)` | Method renamed |
| Native extraction (manual) | Auto-extracted from classpath | LWJGL 3 native JARs handle this transparently |
| `BufferUtils` + `(Buffer)` casts | `BufferUtils` (no casts needed) | LWJGL 3 returns proper buffer types |

### Files Affected

All 7 game source files were modified:
- `RubyDung.java` — window creation, input handling, GLU replacement
- `Player.java` — keyboard input polling
- `Textures.java` — mipmap generation
- `Tesselator.java` — vertex array pointer calls
- `Frustum.java` — GL state queries
- `Chunk.java`, `LevelRenderer.java` — named GL constants

The `NativeLauncher` and `FabricNativeLauncher` were simplified since LWJGL 3 auto-extracts
natives from classpath JARs.

## License

MIT License — see [LICENSE](LICENSE) for details.
