# RDForward ⏩
### Modernizing History.
Play the first version of Minecraft.

On your phone.

With friends on PC...

--------

## Quick Start

Requires **Java 21+** and an internet connection (first build only).

```bash
# First-time setup: downloads RubyDung from Mojang, decompiles, applies patches
./gradlew :rd-game:setupWorkspace

# Build everything (compile + test + fat JARs)
./gradlew buildAll

# Launch the game (single player)
./gradlew :rd-game:runClient
```

### Why BuildTools?

RDForward uses a **Spigot BuildTools-style** build process. The original RubyDung code
(rd-132211) is Mojang's copyrighted property and cannot be redistributed. Instead, our
build tool downloads the original JAR from Mojang's CDN, decompiles it with Vineflower,
and applies our patches — all on your machine. Only the patches (our modifications) are
stored in this repository.

### Developer Workflow

```bash
# After modifying decompiled source in rd-game/src/main/java/:
./gradlew :rd-game:rebuildPatches   # Saves your changes as patch files
# Commit the updated patches in rd-game/patches/
```

## Multiplayer

RDForward adds multiplayer to RubyDung using the Minecraft Classic protocol. Players
can join a shared world, see each other, place/break blocks, and chat.

### Running from Gradle (development)

**Start the server:**
```bash
./gradlew :rd-server:runServer
```
The server listens on port **25565** by default.

**Start one or more clients (auto-connects to localhost):**
```bash
./gradlew :rd-client:runMultiplayer
```

**With custom server address or username:**
```bash
./gradlew :rd-client:runMultiplayer -PmpServer=192.168.1.5:25565 -PmpUsername=Steve
```

### Running from fat JARs (no build tools needed)

Fat JARs are self-contained — just **Java 21+** is required. Build them with:

```bash
./gradlew fatJars       # Builds all 3 fat JARs
./gradlew buildAll      # Full build + fat JARs
```

Output locations:
- `rd-server/build/libs/rd-server-*-all.jar` — Dedicated server
- `rd-client/build/libs/rd-client-*-all.jar` — Modded client (Fabric Loader + multiplayer)
- `rd-game/build/libs/rd-game-*-all.jar` — Vanilla game (single player, no mods)

**Start the server:**
```bash
java -jar rd-server-0.1.0-SNAPSHOT-all.jar           # Default port 25565
java -jar rd-server-0.1.0-SNAPSHOT-all.jar 12345      # Custom port
```

**Start a client:**
```bash
java -jar rd-client-0.1.0-SNAPSHOT-all.jar                            # Connects to localhost:25565
java -jar rd-client-0.1.0-SNAPSHOT-all.jar --server=example.com:25565  # Remote server
java -jar rd-client-0.1.0-SNAPSHOT-all.jar --username=Alice            # Custom name
java -jar rd-client-0.1.0-SNAPSHOT-all.jar --server=10.0.0.5:25565 --username=Bob
```

The `--server` and `--username` flags also work as JVM properties (must go before `-jar`):
```bash
java -Drdforward.server=example.com:25565 -Drdforward.username=Alice -jar rd-client-0.1.0-SNAPSHOT-all.jar
```

If no username is provided, the server auto-assigns one (Player1, Player2, etc.).

### Multiplayer Features

- **Shared world** — 256x64x256 block flat world with grass and cobblestone
- **Player rendering** — remote players shown as colored cubes
- **Block sync** — place/break blocks visible to all connected players
- **Chat** — in-game text messaging
- **Auto-naming** — server assigns unique names, no duplicates allowed

## Project Structure

This is a Gradle multi-module project:

| Module | Description |
|--------|-------------|
| `rd-game` | **The game** — decompiled RubyDung (generated by BuildTools, not in version control) |
| `rd-protocol` | Networking — Netty-based packet codec, MC-compatible protocol, version translation |
| `rd-world` | World persistence — Alpha-format NBT serialization, block registry |
| `rd-client` | Multiplayer client — networking, UI overlays, remote player rendering |
| `rd-server` | Dedicated server — authoritative world state, tick loop, mod event dispatch |

## Key Design Decisions

- **MC-compatible protocol** — packet IDs and wire format match real Minecraft Classic/Alpha
- **Netty** for networking (same library modern MC uses) — scalable to 100+ players
- **ViaVersion-inspired version translation** — block/action mapping between protocol versions
- **Alpha-compatible world format** — worlds can be opened in Minecraft Alpha
- **LWJGL 3.4.1** — ported from LWJGL 2 for Java 21+ compatibility on all platforms (see below)
- **Fabric Loader + SpongePowered Mixin** for mod loading and code injection
- **BuildTools approach** — no copyrighted code in the repository

## Building

Requires Java 21+ and Gradle 8.14+.

```bash
./gradlew :rd-game:setupWorkspace   # First-time only: download, decompile, patch

./gradlew build                     # Compile + test all modules
./gradlew fatJars                   # Build all fat JARs (server + client + game)
./gradlew buildAll                  # build + fatJars combined

# Individual fat JARs
./gradlew :rd-server:fatJar         # Server fat JAR only
./gradlew :rd-game:fatJar           # Vanilla game fat JAR only
./gradlew :rd-client:fatModdedJar   # Modded client fat JAR only
```

### Gradle Run Tasks

| Task | Description |
|------|-------------|
| `./gradlew :rd-game:runClient` | Launch vanilla RubyDung (single player, no mods) |
| `./gradlew :rd-client:runModdedClient` | Launch via Fabric Loader (mods enabled, no multiplayer) |
| `./gradlew :rd-client:runMultiplayer` | Launch modded client + auto-connect to localhost:25565 |
| `./gradlew :rd-server:runServer` | Launch dedicated multiplayer server |

## LWJGL 2 to LWJGL 3 Migration

The original RubyDung (rd-132211) was built against **LWJGL 2.9.3**. We ported it to
**LWJGL 3.4.1** because LWJGL 2's Linux native libraries (`liblwjgl64.so`) depend on
`SUNWprivate_1.1`, a private JDK symbol removed in Java 9+. This makes LWJGL 2 unusable
on Linux with modern Java.

### What Changed

LWJGL 3 is a complete API rewrite, not a drop-in upgrade. Key differences for developers:

| LWJGL 2 | LWJGL 3 | Notes |
|---------|---------|-------|
| `Display.create()` / `setTitle()` | `GLFW.glfwCreateWindow()` | GLFW replaces the Display class entirely |
| `Keyboard.isKeyDown(int)` | `GLFW.glfwGetKey(window, key)` | Key codes changed (e.g. `Keyboard.KEY_W` -> `GLFW.GLFW_KEY_W`) |
| `Keyboard.next()` / event loop | `glfwSetKeyCallback()` | Push-based callbacks instead of poll-based event queue |
| `Mouse.getDX()` / `getDY()` | `glfwSetCursorPosCallback()` | Must track deltas manually from absolute positions |
| `Mouse.setGrabbed(true)` | `glfwSetInputMode(GLFW_CURSOR, GLFW_CURSOR_DISABLED)` | |
| `GLU.gluPerspective()` | Manual matrix math | GLU was removed; perspective matrix built by hand |
| `GLU.gluPickMatrix()` | Manual translate + scale | |
| `GLU.gluBuild2DMipmaps()` | `glTexImage2D()` + `GL30.glGenerateMipmap()` | |
| `GL11.glVertexPointer(size, stride, buf)` | `GL11.glVertexPointer(size, GL_FLOAT, stride, buf)` | Explicit type parameter required |
| `GL11.glGetFloat(int, buf)` | `GL11.glGetFloatv(int, buf)` | Method renamed |
| Native extraction (manual) | Auto-extracted from classpath | LWJGL 3 native JARs handle this transparently |
| `BufferUtils` + `(Buffer)` casts | `BufferUtils` (no casts needed) | LWJGL 3 returns proper buffer types |

### Files Affected

All 7 game source files were modified:
- `RubyDung.java` — window creation, input handling, GLU replacement
- `Player.java` — keyboard input polling
- `Textures.java` — mipmap generation
- `Tesselator.java` — vertex array pointer calls
- `Frustum.java` — GL state queries
- `Chunk.java`, `LevelRenderer.java` — named GL constants

The `NativeLauncher` and `FabricNativeLauncher` were simplified since LWJGL 3 auto-extracts
natives from classpath JARs.

## License

MIT License — see [LICENSE](LICENSE) for details.
